{"ast":null,"code":"import _slicedToArray from\"/Users/kanglantang/Desktop/E-Book/New/ebook0925/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import Webcam from\"react-webcam\";import axios from'axios';import{Button,Row,Col,notification}from'antd';import{CheckCircleOutlined,CloseCircleOutlined,CloudUploadOutlined,PlayCircleOutlined,PauseCircleOutlined}from'@ant-design/icons';export var WebcamStreamCapture=function WebcamStreamCapture(){var webcamRef=React.useRef(null);var mediaRecorderRef=React.useRef(null);var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),capturing=_React$useState2[0],setCapturing=_React$useState2[1];var _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),recordedChunks=_React$useState4[0],setRecordedChunks=_React$useState4[1];var videoConstraints={width:320,height:240,facingMode:\"user\"};var handleStartCaptureClick=React.useCallback(function(){console.log(\"Start Capture\");setCapturing(true);mediaRecorderRef.current=new MediaRecorder(webcamRef.current.stream,{mimeType:\"video/webm\"});mediaRecorderRef.current.addEventListener(\"dataavailable\",handleDataAvailable);mediaRecorderRef.current.start();},[webcamRef,setCapturing,mediaRecorderRef]);var handleDataAvailable=React.useCallback(function(_ref){var data=_ref.data;if(data.size>0){setRecordedChunks(function(prev){return prev.concat(data);});}},[setRecordedChunks]);var handleStopCaptureClick=React.useCallback(function(){console.log(\"Stop Capture\");mediaRecorderRef.current.stop();setCapturing(false);},[mediaRecorderRef,webcamRef,setCapturing]);var handleDownload=React.useCallback(function(){console.log(\"Upload Video\");if(recordedChunks.length){console.log(\"Creating blob\");var blob=new Blob(recordedChunks,{type:\"video/webm\"});var formData=new FormData();formData.append(\"blob\",blob);axios({method:'post',url:\"http://ec2-35-153-79-96.compute-1.amazonaws.com:8080/video/upload\",data:formData}).then(function(response){console.log(\"Success\");console.log(response);notification.open({message:'Successfully uploaded video',icon:/*#__PURE__*/React.createElement(CheckCircleOutlined,{style:{color:'#a0d911'}})});}).catch(function(error){console.log(\"Failed\");console.log(error.response.data.message);notification.open({message:'Failed to upload video',icon:/*#__PURE__*/React.createElement(CloseCircleOutlined,{style:{color:'#f5222d'}})});});//formData.append(\"duration\", 10);\n/*console.log(\"Making new request var\");\n    var request = new XMLHttpRequest();\n    //Change this\n    console.log(\"Starting\");\n    request.open(\"POST\", \"http://ec2-35-153-79-96.compute-1.amazonaws.com:8080/video/upload\");\n    request.send(formData);\n    console.log(\"Sent\");\n    console.log(request.status);\n    if (request.status === 200) {\n      console.log(\"Success\");\n      console.log(request.responseText);\n    } else {\n      console.log(\"Error\");\n      console.log(request.responseText);\n    }\n    console.log(\"Done!\");*/setRecordedChunks([]);}},[recordedChunks]);var stopAndDownload=React.useCallback(function(){handleStopCaptureClick();if(recordedChunks.length>0){handleDownload();}});return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Row,{justify:\"space-around\",align:\"middle\"},/*#__PURE__*/React.createElement(Col,{flex:1},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'}},capturing?/*#__PURE__*/React.createElement(Button,{onClick:handleStopCaptureClick,type:\"primary\",icon:/*#__PURE__*/React.createElement(PauseCircleOutlined,null),danger:true},\"\\u7ED3\\u675F\\u5F55\\u5236\\u5E76\\u4E0A\\u4F20\"):/*#__PURE__*/React.createElement(Button,{onClick:handleStartCaptureClick,type:\"primary\",icon:/*#__PURE__*/React.createElement(PlayCircleOutlined,null)},\"\\u5F00\\u59CB\\u5F55\\u5236\"))),/*#__PURE__*/React.createElement(Col,{flex:3},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'}},/*#__PURE__*/React.createElement(Webcam,{audio:true,ref:webcamRef,videoConstraints:videoConstraints,width:\"180\"}))),/*#__PURE__*/React.createElement(Col,{flex:1},/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'center'}},recordedChunks.length>0&&/*#__PURE__*/React.createElement(Button,{onClick:handleDownload,type:\"primary\",icon:/*#__PURE__*/React.createElement(CloudUploadOutlined,null)},\"\\u5F00\\u59CB\\u4E0A\\u4F20\"),recordedChunks.length<=0&&/*#__PURE__*/React.createElement(Button,{disabled:true,type:\"primary\",icon:/*#__PURE__*/React.createElement(CloudUploadOutlined,null)},\"\\u5F00\\u59CB\\u4E0A\\u4F20\")))),/*#__PURE__*/React.createElement(Row,{style:{marginBottom:8}})));};","map":{"version":3,"sources":["/Users/kanglantang/Desktop/E-Book/New/ebook0925/src/components/WebcamStreamCapture.js"],"names":["React","Webcam","axios","Button","Row","Col","notification","CheckCircleOutlined","CloseCircleOutlined","CloudUploadOutlined","PlayCircleOutlined","PauseCircleOutlined","WebcamStreamCapture","webcamRef","useRef","mediaRecorderRef","useState","capturing","setCapturing","recordedChunks","setRecordedChunks","videoConstraints","width","height","facingMode","handleStartCaptureClick","useCallback","console","log","current","MediaRecorder","stream","mimeType","addEventListener","handleDataAvailable","start","data","size","prev","concat","handleStopCaptureClick","stop","handleDownload","length","blob","Blob","type","formData","FormData","append","method","url","then","response","open","message","icon","color","catch","error","stopAndDownload","display","alignItems","justifyContent","marginBottom"],"mappings":"sKAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,MAAP,KAAmB,cAAnB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,MAAT,CAAiBC,GAAjB,CAAsBC,GAAtB,CAA2BC,YAA3B,KAA+C,MAA/C,CACA,OAASC,mBAAT,CAA8BC,mBAA9B,CAAmDC,mBAAnD,CAAwEC,kBAAxE,CAA4FC,mBAA5F,KAAuH,mBAAvH,CAGA,MAAO,IAAMC,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,EAAM,CACvC,GAAMC,CAAAA,SAAS,CAAGb,KAAK,CAACc,MAAN,CAAa,IAAb,CAAlB,CACA,GAAMC,CAAAA,gBAAgB,CAAGf,KAAK,CAACc,MAAN,CAAa,IAAb,CAAzB,CAFuC,oBAGLd,KAAK,CAACgB,QAAN,CAAe,KAAf,CAHK,oDAGhCC,SAHgC,qBAGrBC,YAHqB,0CAIKlB,KAAK,CAACgB,QAAN,CAAe,EAAf,CAJL,qDAIhCG,cAJgC,qBAIhBC,iBAJgB,qBAMvC,GAAMC,CAAAA,gBAAgB,CAAG,CACvBC,KAAK,CAAE,GADgB,CAEvBC,MAAM,CAAE,GAFe,CAGvBC,UAAU,CAAE,MAHW,CAAzB,CAMA,GAAMC,CAAAA,uBAAuB,CAAGzB,KAAK,CAAC0B,WAAN,CAAkB,UAAM,CACtDC,OAAO,CAACC,GAAR,CAAY,eAAZ,EACAV,YAAY,CAAC,IAAD,CAAZ,CACAH,gBAAgB,CAACc,OAAjB,CAA2B,GAAIC,CAAAA,aAAJ,CAAkBjB,SAAS,CAACgB,OAAV,CAAkBE,MAApC,CAA4C,CACrEC,QAAQ,CAAE,YAD2D,CAA5C,CAA3B,CAGAjB,gBAAgB,CAACc,OAAjB,CAAyBI,gBAAzB,CACE,eADF,CAEEC,mBAFF,EAIAnB,gBAAgB,CAACc,OAAjB,CAAyBM,KAAzB,GACD,CAX+B,CAW7B,CAACtB,SAAD,CAAYK,YAAZ,CAA0BH,gBAA1B,CAX6B,CAAhC,CAaA,GAAMmB,CAAAA,mBAAmB,CAAGlC,KAAK,CAAC0B,WAAN,CAC1B,cAAc,IAAXU,CAAAA,IAAW,MAAXA,IAAW,CACZ,GAAIA,IAAI,CAACC,IAAL,CAAY,CAAhB,CAAmB,CACjBjB,iBAAiB,CAAC,SAACkB,IAAD,QAAUA,CAAAA,IAAI,CAACC,MAAL,CAAYH,IAAZ,CAAV,EAAD,CAAjB,CACD,CACF,CALyB,CAM1B,CAAChB,iBAAD,CAN0B,CAA5B,CASA,GAAMoB,CAAAA,sBAAsB,CAAGxC,KAAK,CAAC0B,WAAN,CAAkB,UAAM,CACrDC,OAAO,CAACC,GAAR,CAAY,cAAZ,EACAb,gBAAgB,CAACc,OAAjB,CAAyBY,IAAzB,GACAvB,YAAY,CAAC,KAAD,CAAZ,CACD,CAJ8B,CAI5B,CAACH,gBAAD,CAAmBF,SAAnB,CAA8BK,YAA9B,CAJ4B,CAA/B,CAMA,GAAMwB,CAAAA,cAAc,CAAG1C,KAAK,CAAC0B,WAAN,CAAkB,UAAM,CAC7CC,OAAO,CAACC,GAAR,CAAY,cAAZ,EACA,GAAIT,cAAc,CAACwB,MAAnB,CAA2B,CACzBhB,OAAO,CAACC,GAAR,CAAY,eAAZ,EACA,GAAMgB,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAAS1B,cAAT,CAAyB,CACpC2B,IAAI,CAAE,YAD8B,CAAzB,CAAb,CAGF,GAAIC,CAAAA,QAAQ,CAAG,GAAIC,CAAAA,QAAJ,EAAf,CACAD,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBL,IAAxB,EAEA1C,KAAK,CAAC,CACJgD,MAAM,CAAE,MADJ,CAEJC,GAAG,CAAE,mEAFD,CAGJf,IAAI,CAAEW,QAHF,CAAD,CAAL,CAIGK,IAJH,CAIQ,SAAUC,QAAV,CAAoB,CAC1B1B,OAAO,CAACC,GAAR,CAAY,SAAZ,EACAD,OAAO,CAACC,GAAR,CAAYyB,QAAZ,EACA/C,YAAY,CAACgD,IAAb,CAAkB,CAChBC,OAAO,CAAE,6BADO,CAEhBC,IAAI,cAAE,oBAAC,mBAAD,EAAsB,KAAK,CAAE,CAAEC,KAAK,CAAE,SAAT,CAA7B,EAFU,CAAlB,EAID,CAXD,EAYCC,KAZD,CAYO,SAAUC,KAAV,CAAiB,CACtBhC,OAAO,CAACC,GAAR,CAAY,QAAZ,EACAD,OAAO,CAACC,GAAR,CAAY+B,KAAK,CAACN,QAAN,CAAejB,IAAf,CAAoBmB,OAAhC,EACAjD,YAAY,CAACgD,IAAb,CAAkB,CAChBC,OAAO,CAAE,wBADO,CAEhBC,IAAI,cAAE,oBAAC,mBAAD,EAAsB,KAAK,CAAE,CAAEC,KAAK,CAAE,SAAT,CAA7B,EAFU,CAAlB,EAID,CAnBD,EAqBA;AACA;;;;;;;;;;;;;;;2BAiBArC,iBAAiB,CAAC,EAAD,CAAjB,CACC,CACF,CAnDsB,CAmDpB,CAACD,cAAD,CAnDoB,CAAvB,CAqDA,GAAMyC,CAAAA,eAAe,CAAG5D,KAAK,CAAC0B,WAAN,CAAkB,UAAM,CAC9Cc,sBAAsB,GACtB,GAAIrB,cAAc,CAACwB,MAAf,CAAwB,CAA5B,CAA8B,CAC5BD,cAAc,GACf,CACF,CALuB,CAAxB,CAOA,mBACE,qDACE,4CACE,oBAAC,GAAD,EAAK,OAAO,CAAC,cAAb,CAA4B,KAAK,CAAC,QAAlC,eACE,oBAAC,GAAD,EAAK,IAAI,CAAE,CAAX,eACE,2BAAK,KAAK,CAAE,CACRmB,OAAO,CAAE,MADD,CAERC,UAAU,CAAE,QAFJ,CAGRC,cAAc,CAAE,QAHR,CAAZ,EAKG9C,SAAS,cACV,oBAAC,MAAD,EAAQ,OAAO,CAAEuB,sBAAjB,CAAyC,IAAI,CAAC,SAA9C,CAAwD,IAAI,cAAE,oBAAC,mBAAD,MAA9D,CAAuF,MAAM,KAA7F,+CADU,cAGR,oBAAC,MAAD,EAAQ,OAAO,CAAEf,uBAAjB,CACE,IAAI,CAAC,SADP,CAEE,IAAI,cAAE,oBAAC,kBAAD,MAFR,6BARJ,CADF,CADF,cAkBE,oBAAC,GAAD,EAAK,IAAI,CAAE,CAAX,eACE,2BAAK,KAAK,CAAE,CACRoC,OAAO,CAAE,MADD,CAERC,UAAU,CAAE,QAFJ,CAGRC,cAAc,CAAE,QAHR,CAAZ,eAKE,oBAAC,MAAD,EAAQ,KAAK,CAAE,IAAf,CAAqB,GAAG,CAAElD,SAA1B,CAAqC,gBAAgB,CAAEQ,gBAAvD,CAAyE,KAAK,CAAC,KAA/E,EALF,CADF,CAlBF,cA4BE,oBAAC,GAAD,EAAK,IAAI,CAAE,CAAX,eACE,2BAAK,KAAK,CAAE,CACRwC,OAAO,CAAE,MADD,CAERC,UAAU,CAAE,QAFJ,CAGRC,cAAc,CAAE,QAHR,CAAZ,EAKG5C,cAAc,CAACwB,MAAf,CAAwB,CAAxB,eACC,oBAAC,MAAD,EAAQ,OAAO,CAAED,cAAjB,CACA,IAAI,CAAC,SADL,CAEA,IAAI,cAAE,oBAAC,mBAAD,MAFN,6BANJ,CAWGvB,cAAc,CAACwB,MAAf,EAAyB,CAAzB,eACC,oBAAC,MAAD,EAAQ,QAAQ,KAAhB,CACA,IAAI,CAAC,SADL,CAEA,IAAI,cAAE,oBAAC,mBAAD,MAFN,6BAZJ,CADF,CA5BF,CADF,cAmDE,oBAAC,GAAD,EAAK,KAAK,CAAE,CAAEqB,YAAY,CAAE,CAAhB,CAAZ,EAnDF,CADF,CADF,CA2DD,CA/JM","sourcesContent":["import React from 'react';\nimport Webcam from \"react-webcam\";\nimport axios from 'axios';\nimport { Button, Row, Col, notification } from 'antd';\nimport { CheckCircleOutlined, CloseCircleOutlined, CloudUploadOutlined, PlayCircleOutlined, PauseCircleOutlined } from '@ant-design/icons';\n\n\nexport const WebcamStreamCapture = () => {\n  const webcamRef = React.useRef(null);\n  const mediaRecorderRef = React.useRef(null);\n  const [capturing, setCapturing] = React.useState(false);\n  const [recordedChunks, setRecordedChunks] = React.useState([]);\n\n  const videoConstraints = {\n    width: 320,\n    height: 240,\n    facingMode: \"user\"\n  };\n\n  const handleStartCaptureClick = React.useCallback(() => {\n    console.log(\"Start Capture\");\n    setCapturing(true);\n    mediaRecorderRef.current = new MediaRecorder(webcamRef.current.stream, {\n      mimeType: \"video/webm\"\n    });\n    mediaRecorderRef.current.addEventListener(\n      \"dataavailable\",\n      handleDataAvailable\n    );\n    mediaRecorderRef.current.start();\n  }, [webcamRef, setCapturing, mediaRecorderRef]);\n\n  const handleDataAvailable = React.useCallback(\n    ({ data }) => {\n      if (data.size > 0) {\n        setRecordedChunks((prev) => prev.concat(data));\n      }\n    },\n    [setRecordedChunks]\n  );\n\n  const handleStopCaptureClick = React.useCallback(() => {\n    console.log(\"Stop Capture\");\n    mediaRecorderRef.current.stop();\n    setCapturing(false);\n  }, [mediaRecorderRef, webcamRef, setCapturing]);\n\n  const handleDownload = React.useCallback(() => {\n    console.log(\"Upload Video\");\n    if (recordedChunks.length) {\n      console.log(\"Creating blob\");\n      const blob = new Blob(recordedChunks, {\n        type: \"video/webm\"\n      });\n    var formData = new FormData();\n    formData.append(\"blob\", blob);\n\n    axios({\n      method: 'post',\n      url: \"http://ec2-35-153-79-96.compute-1.amazonaws.com:8080/video/upload\",\n      data: formData, \n    }).then(function (response) {\n      console.log(\"Success\");\n      console.log(response);\n      notification.open({\n        message: 'Successfully uploaded video',\n        icon: <CheckCircleOutlined  style={{ color: '#a0d911' }} />,\n      });\n    })\n    .catch(function (error) {\n      console.log(\"Failed\");\n      console.log(error.response.data.message);\n      notification.open({\n        message: 'Failed to upload video',\n        icon: <CloseCircleOutlined  style={{ color: '#f5222d' }} />,\n      });\n    });\n\n    //formData.append(\"duration\", 10);\n    /*console.log(\"Making new request var\");\n    var request = new XMLHttpRequest();\n    //Change this\n    console.log(\"Starting\");\n    request.open(\"POST\", \"http://ec2-35-153-79-96.compute-1.amazonaws.com:8080/video/upload\");\n    request.send(formData);\n    console.log(\"Sent\");\n    console.log(request.status);\n    if (request.status === 200) {\n      console.log(\"Success\");\n      console.log(request.responseText);\n    } else {\n      console.log(\"Error\");\n      console.log(request.responseText);\n    }\n    console.log(\"Done!\");*/\n\n    setRecordedChunks([]);\n    }\n  }, [recordedChunks]);\n\n  const stopAndDownload = React.useCallback(() => { \n    handleStopCaptureClick();\n    if (recordedChunks.length > 0){\n      handleDownload();\n    }\n  });\n\n  return (\n    <>\n      <div>\n        <Row justify=\"space-around\" align=\"middle\">\n          <Col flex={1}>\n            <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n            }}>\n              {capturing ? (\n              <Button onClick={handleStopCaptureClick} type=\"primary\" icon={<PauseCircleOutlined />} danger>结束录制并上传</Button>\n              ) : (\n                <Button onClick={handleStartCaptureClick}\n                  type=\"primary\"\n                  icon={<PlayCircleOutlined />}\n                >开始录制</Button>\n              )}\n            </div>\n          </Col>\n\n          <Col flex={3}>\n            <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n            }}>\n              <Webcam audio={true} ref={webcamRef} videoConstraints={videoConstraints} width=\"180\"/>\n            </div>\n          </Col>\n\n          <Col flex={1}>\n            <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n            }}>\n              {recordedChunks.length > 0 && (\n                <Button onClick={handleDownload} \n                type=\"primary\"\n                icon={<CloudUploadOutlined />}\n                >开始上传</Button>\n              )}\n              {recordedChunks.length <= 0 && (\n                <Button disabled\n                type=\"primary\"\n                icon={<CloudUploadOutlined />}\n                >开始上传</Button>\n              )}\n            </div>\n          </Col>\n        </Row>\n\n        <Row style={{ marginBottom: 8 }}></Row>\n\n      </div>\n      \n    </>\n  );\n};"]},"metadata":{},"sourceType":"module"}